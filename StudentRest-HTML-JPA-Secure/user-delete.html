<!DOCTYPE HTML> 
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

</head>
<body> 

<script>
function getCurrentUser() {
	$.ajax({
	    url: "/EagleEventService/system/systemservices/users/current",
	    type: 'GET',
	    datatype: 'json',
	    statusCode: {
	    200: function( response ) {
	
			$('#userWelcome').html("Welcome, "+response.firstName+" "+response.lastName);
	    },
	    401:function( response ) {
	    		$('#student-list-table').html("You must Login first");}
	    },
	    
	    error: function(jqXHR, textStatus, errorThrown) {
  	        console.log("error " + textStatus);
  	        console.log("incoming Text " + jqXHR.responseText);},
	    beforeSend: setHeader       
	  });   	
}
function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}

function setHeader(xhr) {
	  token = getCookie("token");
	  xhr.setRequestHeader('Authorization', 'Bearer '+token );		  
}
$.urlParam = function(name){
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null){
       return null;
    }
    else{
       return results[1] || 0;
    }
}

$(document).ready(function() {
	getCurrentUser();
	$.ajax( { 
		url:"/EagleEventService/system/systemservices/users/"+$.urlParam("id"),
		type: "GET",
		dataType: "json",
		contentType: "application/json",
		
		statusCode: {
		200: function( response ) {
			console.log(response)
			$('#deleteMessage').html("Delete record for: "+response.firstName+" "+response.lastName+"?");
	  		},
	  	401:function( response ) {
	  		$('#deleteMessage').html("You must Login first");
	  		},
	  	405:function( response ) {
  	    		$('#page-messge').html("Access to the page forbiden");
  	    		},
		404 : function(jqXHR, textStatus, errorThrown) {
			$("#deleteMessage").html("Error:"+textStatus);
			consule.log(errorThrown);
		        console.log("error " + textStatus);
		        console.log("incoming Text " + jqXHR.responseText);
		     }
		},
	    beforeSend: setHeader,
		error: function(jqXHR, textStatus, errorThrown) {
		    console.log("error " + textStatus);
		    console.log("incoming Text " + jqXHR.responseText);
		    }
	});


$("#deletebtn").click(function (e){
	console.log("delete function");
	$('#deleteMessage').html("Deleting record ... Wait");
	$('#deletebtn').attr("disabled", true);
	
	$.ajax({ 
		url:"/EagleEventService/system/systemservices/users/"+$.urlParam("id"),
		type: "DELETE",
		statusCode: {
			200: function( response ) {
				  console.log("Delete success ");
				  window.location.assign("user-list.html");},
		  	
		  	401:function( response ) {
		  		$('#deleteMessage').html("You must Login first");
		  		},
		  	403:function( response ) {
	  	    		$('#page-messge').html("Access to the page forbiden");
	  	    		},
			404 : function(jqXHR, textStatus, errorThrown) {
				$("#page-message").html("Error:"+textStatus);
				consule.log(errorThrown);
			        console.log("error " + textStatus);
			        console.log("incoming Text " + jqXHR.responseText);
			    }
			},
	  beforeSend: setHeader,
	  fail: (function(jqXHR, textStatus, errorThrown) {
 	      console.log("Delete error " + textStatus);
 	      console.log("incoming Text " + jqXHR.responseText);
	  })

  	 });
});	
})

</script>
<div>
<ul class="nav">
<li><a href="student-list.html">Students</a></li>
<li><a href="user-list.html">Users</a></li>
<li><a href="logout.html">Logout</a></li>
</ul>
</div>
<div id="userWelcome"> </div>
<h2>Student Delete</h2>
<div class ='block-center'>
<br><br>
<p id='deleteMessage'></p>
<br><br>

<input class ='inline' id ='deletebtn' type="button" value="Delete">

<form action="student-list.html" method ="GET">
<button type="submit" >Cancel</button>
</form>
</div>
</body>
</html>



